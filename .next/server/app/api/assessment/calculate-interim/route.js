"use strict";(()=>{var e={};e.id=49,e.ids=[49],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4964:(e,n,s)=>{s.r(n),s.d(n,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var t={};s.r(t),s.d(t,{POST:()=>l});var r=s(9303),o=s(8716),i=s(670),a=s(7070),c=s(1483);async function l(e){if(!("false"!==process.env.NEXT_PUBLIC_INTERIM_API_ENABLED))return a.NextResponse.json({error:"Interim results temporarily unavailable",fallback:!0,redirect:"/api/assessment/calculate"},{status:503});try{var n;let s=await e.json(),{sessionId:t,responses:r}=s;if(!t||!r||!Array.isArray(r))return a.NextResponse.json({error:"Invalid request data. SessionId and responses array required."},{status:400});let o=r.filter(e=>"core"===e.questionType);if(4!==o.length)return console.error(`Interim API: Expected 4 core responses, got ${o.length}. Total responses: ${r.length}`),a.NextResponse.json({error:`Invalid core responses count. Expected 4, got ${o.length}`,debug:{totalResponses:r.length,coreResponses:o.length,responseTypes:r.map(e=>e.questionType)}},{status:400});let i=c.p.getInstance().calculateInterimResults(o),l=function(e,n,s){let t=[],r="ar"===s,o=n.find(e=>"E/I"===e.dimension);o&&("E"===o.preference?t.push(r?"يبدو أنك تستمد طاقتك من التفاعل مع الآخرين والعالم الخارجي":"You appear to draw energy from interacting with others and the external world"):t.push(r?"يبدو أنك تفضل التفكير الداخلي والتأمل للحصول على الطاقة":"You seem to prefer inner reflection and introspection for energy"));let i=n.find(e=>"S/N"===e.dimension);i&&("S"===i.preference?t.push(r?"تميل إلى التركيز على التفاصيل الملموسة والحقائق الواقعية":"You tend to focus on concrete details and practical realities"):t.push(r?"تميل إلى رؤية الصورة الكبيرة والاحتمالات المستقبلية":"You tend to see the big picture and future possibilities"));let a=n.find(e=>"T/F"===e.dimension);return a&&("T"===a.preference?t.push(r?"تفضل اتخاذ القرارات بناءً على المنطق والتحليل الموضوعي":"You prefer making decisions based on logic and objective analysis"):t.push(r?"تأخذ في الاعتبار القيم الشخصية وتأثير القرارات على الآخرين":"You consider personal values and the impact of decisions on others")),t.slice(0,3)}(i.mbtiType,i.dimensionScores,s.language||"en");return a.NextResponse.json({success:!0,interimResult:{...i,confidence:Math.min(i.overallConfidence,65),insights:l,disclaimer:(n=s.language||"en","ar"===n?"هذه نتائج أولية بناءً على 4 أسئلة فقط. ستصبح النتائج أكثر دقة بعد إكمال الأسئلة الإضافية.":"These are preliminary results based on only 4 questions. Results will become more accurate after completing additional questions.")}})}catch(e){return console.error("Interim calculation error:",e),a.NextResponse.json({error:"Failed to calculate interim results"},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/assessment/calculate-interim/route",pathname:"/api/assessment/calculate-interim",filename:"route",bundlePath:"app/api/assessment/calculate-interim/route"},resolvedPagePath:"C:\\Users\\am112\\OneDrive\\سطح المكتب\\Clients\\MBTI\\src\\app\\api\\assessment\\calculate-interim\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=u,f="/api/assessment/calculate-interim/route";function g(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},1483:(e,n,s)=>{s.d(n,{p:()=>t});class t{constructor(){this.consciousnessDomains={"E/I":{name:"مصدر حيويتك وتفاعلك",E:{name:"التفاعل الخارجي",description:"استمداد الحيوية من التفاعل مع الطيف الواسع من النشاطات والأشخاص"},I:{name:"الانغماس الداخلي",description:"الانغماس في عالمك الداخلي الغني والاتصال بمركز جذري عميق وهادئ"}},"S/N":{name:"طريقة استقبالك للمعلومات",S:{name:"الواقع المادي",description:"التفاعل مع الواقع المادي الملموس واستخدام الحواس الخمس"},N:{name:"البصيرة الحدسية",description:"الغوص في بحر الاحتمالات والمعاني الخفية باستخدام العين الثالثة"}},"T/F":{name:"مركز اتخاذ القرار",T:{name:"التحليل المنطقي",description:"تحليل منطقي وموضوعي للحقائق وبناء هيكل عقلي متماسك"},F:{name:"بوصلة القيم الداخلية",description:"الاتصال بمركز القلب والانسجام مع مشاعر الآخرين وقيمك الداخلية"}},"J/P":{name:"تنظيم عالمك الخارجي",J:{name:"الهيكل المنظم",description:"وضع هيكل زمني ونظام واضح للسيطرة والتنبؤ بالأحداث"},P:{name:"المرونة العفوية",description:"ترك مساحة للمرونة والعفوية وإبقاء الخيارات مفتوحة"}}}}static getInstance(){return t.instance||(t.instance=new t),t.instance}calculateMBTI(e){let n;let{sessionId:s,responses:t,methodology:r,isInterim:o=!1}=e,i=this.calculateDimensionScores(t,r),a=this.determineMBTIType(i),c=this.calculateOverallConfidence(i);return"sais"===r&&(n=this.generateConsciousnessProfile(i)),{sessionId:s,mbtiType:a,dimensionScores:i,overallConfidence:c,methodology:r,isInterim:o,totalResponses:t.length,consciousnessProfile:n}}calculateDimensionScores(e,n){let s=[];for(let t of["E/I","S/N","T/F","J/P"]){let r,o,i;let a=e.filter(e=>e.mbtiDimension===t),c=0,l=0;for(let e of a)if("sais"===n&&"distribution"===e.responseType){let n=e.distributionA||0,s=e.distributionB||0;c+=n,l+=s}else"binary"===e.responseType&&("A"===e.selectedOption?c+=1:"B"===e.selectedOption&&(l+=1));let u=this.determinePreference(t,c,l,a),d=this.calculateConfidence(c,l,n);if("sais"===n){i=15;let e=0;for(let n of a)n.tendency===u&&"distribution"===n.responseType&&(e+="A"===n.selectedOption?n.distributionA:n.distributionB);r=Math.round(e/i*100),o=this.consciousnessDomains[t].name}s.push({dimension:t,rawScoreA:c,rawScoreB:l,preference:u,confidence:d,consciousnessPercentage:r,consciousnessDomain:o,totalPossiblePoints:i})}return s}determinePreference(e,n,s,t){if(t&&t.length>0){let e=t.find(e=>"distribution"===e.responseType);if(e&&e.tendency){let e={};for(let n of t)if(n.tendency){if(e[n.tendency]||(e[n.tendency]=0),"distribution"===n.responseType){let s="A"===n.selectedOption?n.distributionA||0:n.distributionB||0;e[n.tendency]+=s}else e[n.tendency]+=1}let n=Object.entries(e);if(n.length>0)return n.sort((e,n)=>n[1]-e[1]),n[0][0]}}let r={"E/I":{A:"E",B:"I"},"S/N":{A:"S",B:"N"},"T/F":{A:"T",B:"F"},"J/P":{A:"J",B:"P"}};return n>s?r[e].A:r[e].B}calculateConfidence(e,n,s){let t=e+n;if(0===t)return 50;let r=Math.max(e,n)/t*100;return"sais"===s&&t>0&&(r=50+Math.abs(e-n)/t*50),Math.round(r)}determineMBTIType(e){return e.map(e=>e.preference).join("")}calculateOverallConfidence(e){return Math.round(e.reduce((e,n)=>e+n.confidence,0)/e.length)}calculateInterimResults(e){let n=["E/I","S/N","T/F","J/P"],s=[];for(let t=0;t<Math.min(4,e.length);t++){let r=e[t];!r.mbtiDimension&&t<n.length&&(r.mbtiDimension=n[t]),s.push(r)}return this.calculateMBTI({sessionId:e[0]?.sessionId||"",responses:s,methodology:"scenarios",isInterim:!0})}isSAISScoreValid(e,n){return[[5,0],[4,1],[3,2],[2,3],[1,4],[0,5]].some(([s,t])=>e===s&&n===t)}validateSAISDistribution(e,n){return e>=0&&e<=5&&n>=0&&n<=5&&e+n===5&&Number.isInteger(e)&&Number.isInteger(n)}generateConsciousnessProfile(e){let n=n=>{let s=e.find(e=>e.dimension===n),t=this.consciousnessDomains[n][s.preference];return t?{dimension:n,preference:s.preference,percentage:s.consciousnessPercentage||0,arabicDomainName:t.name,consciousnessDescription:t.description}:(console.warn(`No preference data found for ${n}:${s.preference}`),{dimension:n,preference:s.preference,percentage:s.consciousnessPercentage||0,arabicDomainName:s.preference,consciousnessDescription:"وصف غير متاح"})};return{energySourcePattern:n("E/I"),awarenessStyle:n("S/N"),decisionMakingCenter:n("T/F"),lifeStructurePreference:n("J/P")}}testSAISScoring(e){console.log("SAIS Scoring Test:"),console.log("==================");let n=this.calculateMBTI({sessionId:"test-session",responses:e,methodology:"sais",isInterim:!1});console.log("MBTI Type:",n.mbtiType),console.log("Overall Confidence:",n.overallConfidence+"%"),console.log("\nDimension Breakdown:"),n.dimensionScores.forEach(e=>{console.log(`${e.dimension}: ${e.preference} (${e.confidence}% confidence)`),console.log(`  Raw scores: A=${e.rawScoreA}, B=${e.rawScoreB}`),e.consciousnessPercentage&&console.log(`  Consciousness: ${e.consciousnessPercentage}% - ${e.consciousnessDomain}`)}),n.consciousnessProfile&&(console.log("\nConsciousness Profile:"),console.log("Energy Source:",n.consciousnessProfile.energySourcePattern.arabicDomainName,`(${n.consciousnessProfile.energySourcePattern.percentage}%)`),console.log("Awareness Style:",n.consciousnessProfile.awarenessStyle.arabicDomainName,`(${n.consciousnessProfile.awarenessStyle.percentage}%)`),console.log("Decision Center:",n.consciousnessProfile.decisionMakingCenter.arabicDomainName,`(${n.consciousnessProfile.decisionMakingCenter.percentage}%)`),console.log("Life Structure:",n.consciousnessProfile.lifeStructurePreference.arabicDomainName,`(${n.consciousnessProfile.lifeStructurePreference.percentage}%)`))}}}};var n=require("../../../../webpack-runtime.js");n.C(e);var s=e=>n(n.s=e),t=n.X(0,[276,972],()=>s(4964));module.exports=t})();