"use strict";(()=>{var e={};e.id=49,e.ids=[49],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4964:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s={};n.r(s),n.d(s,{POST:()=>c});var r=n(9303),i=n(8716),a=n(670),o=n(7070),l=n(1483);async function c(e){if(!("false"!==process.env.NEXT_PUBLIC_INTERIM_API_ENABLED))return o.NextResponse.json({error:"Interim results temporarily unavailable",fallback:!0,redirect:"/api/assessment/calculate"},{status:503});try{var t;let n=await e.json(),{sessionId:s,responses:r}=n;if(!s||!r||!Array.isArray(r))return o.NextResponse.json({error:"Invalid request data. SessionId and responses array required."},{status:400});let i=r.filter(e=>"core"===e.questionType);if(4!==i.length)return console.error(`Interim API: Expected 4 core responses, got ${i.length}. Total responses: ${r.length}`),o.NextResponse.json({error:`Invalid core responses count. Expected 4, got ${i.length}`,debug:{totalResponses:r.length,coreResponses:i.length,responseTypes:r.map(e=>e.questionType)}},{status:400});let a=l.p.getInstance().calculateInterimResults(i),c=function(e,t,n){let s=[],r="ar"===n,i=t.find(e=>"E/I"===e.dimension);i&&("E"===i.preference?s.push(r?"يبدو أنك تستمد طاقتك من التفاعل مع الآخرين والعالم الخارجي":"You appear to draw energy from interacting with others and the external world"):s.push(r?"يبدو أنك تفضل التفكير الداخلي والتأمل للحصول على الطاقة":"You seem to prefer inner reflection and introspection for energy"));let a=t.find(e=>"S/N"===e.dimension);a&&("S"===a.preference?s.push(r?"تميل إلى التركيز على التفاصيل الملموسة والحقائق الواقعية":"You tend to focus on concrete details and practical realities"):s.push(r?"تميل إلى رؤية الصورة الكبيرة والاحتمالات المستقبلية":"You tend to see the big picture and future possibilities"));let o=t.find(e=>"T/F"===e.dimension);return o&&("T"===o.preference?s.push(r?"تفضل اتخاذ القرارات بناءً على المنطق والتحليل الموضوعي":"You prefer making decisions based on logic and objective analysis"):s.push(r?"تأخذ في الاعتبار القيم الشخصية وتأثير القرارات على الآخرين":"You consider personal values and the impact of decisions on others")),s.slice(0,3)}(a.mbtiType,a.dimensionScores,n.language||"en");return o.NextResponse.json({success:!0,interimResult:{...a,confidence:Math.min(a.overallConfidence,65),insights:c,disclaimer:(t=n.language||"en","ar"===t?"هذه نتائج أولية بناءً على 4 أسئلة فقط. ستصبح النتائج أكثر دقة بعد إكمال الأسئلة الإضافية.":"These are preliminary results based on only 4 questions. Results will become more accurate after completing additional questions.")}})}catch(e){return console.error("Interim calculation error:",e),o.NextResponse.json({error:"Failed to calculate interim results"},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/assessment/calculate-interim/route",pathname:"/api/assessment/calculate-interim",filename:"route",bundlePath:"app/api/assessment/calculate-interim/route"},resolvedPagePath:"C:\\Users\\am112\\OneDrive\\سطح المكتب\\Clients\\MBTI\\src\\app\\api\\assessment\\calculate-interim\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=u,h="/api/assessment/calculate-interim/route";function f(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},1483:(e,t,n)=>{n.d(t,{p:()=>s});class s{constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}calculateMBTI(e){let{sessionId:t,responses:n,methodology:s,isInterim:r=!1}=e,i=this.calculateDimensionScores(n,s),a=this.determineMBTIType(i),o=this.calculateOverallConfidence(i);return{sessionId:t,mbtiType:a,dimensionScores:i,overallConfidence:o,methodology:s,isInterim:r,totalResponses:n.length}}calculateDimensionScores(e,t){let n=[];for(let s of["E/I","S/N","T/F","J/P"]){let r=e.filter(e=>e.mbtiDimension===s),i=0,a=0;for(let e of r)"sais"===t&&"distribution"===e.responseType?(i+=e.distributionA||0,a+=e.distributionB||0):"binary"===e.responseType&&("A"===e.selectedOption?i+=1:"B"===e.selectedOption&&(a+=1));let o=this.determinePreference(s,i,a),l=this.calculateConfidence(i,a);n.push({dimension:s,rawScoreA:i,rawScoreB:a,preference:o,confidence:l})}return n}determinePreference(e,t,n){let s={"E/I":{A:"E",B:"I"},"S/N":{A:"S",B:"N"},"T/F":{A:"T",B:"F"},"J/P":{A:"J",B:"P"}};return t>n?s[e].A:s[e].B}calculateConfidence(e,t){let n=e+t;return 0===n?50:Math.round(Math.max(e,t)/n*100)}determineMBTIType(e){return e.map(e=>e.preference).join("")}calculateOverallConfidence(e){return Math.round(e.reduce((e,t)=>e+t.confidence,0)/e.length)}calculateInterimResults(e){let t=["E/I","S/N","T/F","J/P"],n=[];for(let s=0;s<Math.min(4,e.length);s++){let r=e[s];!r.mbtiDimension&&s<t.length&&(r.mbtiDimension=t[s]),n.push(r)}return this.calculateMBTI({sessionId:e[0]?.sessionId||"",responses:n,methodology:"scenarios",isInterim:!0})}isSAISScoreValid(e,t){return[[5,0],[4,1],[3,2],[2,3],[1,4],[0,5]].some(([n,s])=>e===n&&t===s)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[276,972],()=>n(4964));module.exports=s})();