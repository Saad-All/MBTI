"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[98],{5921:function(e,s,t){t.d(s,{m:function(){return r}});class r{static initializeSession(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"core",t=Date.now(),r=this.getTimeoutForPhase(s),o={sessionId:e,phase:s,createdAt:t,lastActiveAt:t,expiresAt:t+r};return this.saveSessionData(o),this.startAutoExtension(),o}static getTimeoutForPhase(e){return"extended"===e?1728e5:108e5}static transitionToExtendedPhase(e){let s=this.getSessionData();if(!s||s.sessionId!==e)return null;let t=Date.now();return s.phase="extended",s.extendedPhaseStartedAt=t,s.lastActiveAt=t,s.expiresAt=t+1728e5,this.saveSessionData(s),s}static updateActivity(){let e=this.getSessionData();if(!e||this.isSessionExpired(e))return;let s=Date.now();e.lastActiveAt=s,"extended"===e.phase&&s-e.lastActiveAt<3e5&&(e.expiresAt=s+1728e5),this.saveSessionData(e)}static isExtendedPhase(){let e=this.getSessionData();return(null==e?void 0:e.phase)==="extended"}static getCurrentPhase(){let e=this.getSessionData();return(null==e?void 0:e.phase)||null}static isSessionExpired(e){let s=e||this.getSessionData();return!s||Date.now()>s.expiresAt}static getTimeRemaining(){let e=this.getSessionData();return!e||this.isSessionExpired(e)?0:Math.max(0,e.expiresAt-Date.now())}static cleanupExpiredSession(){let e=this.getSessionData();e&&this.isSessionExpired(e)&&this.clearSessionData()}static getSessionData(){try{let e=localStorage.getItem(this.SESSION_KEY);if(!e)return null;return JSON.parse(e)}catch(e){return null}}static saveSessionData(e){try{localStorage.setItem(this.SESSION_KEY,JSON.stringify(e))}catch(e){console.error("Failed to save session data:",e)}}static clearSessionData(){try{localStorage.removeItem(this.SESSION_KEY),this.stopAutoExtension()}catch(e){console.error("Failed to clear session data:",e)}}static startAutoExtension(){this.stopAutoExtension(),this.extensionTimer=setInterval(()=>{this.updateActivity()},3e5)}static stopAutoExtension(){this.extensionTimer&&(clearInterval(this.extensionTimer),this.extensionTimer=null)}static validateSessionState(e){let s=this.getSessionData();if(!s||e.sessionId!==s.sessionId||this.isSessionExpired(s))return!1;let t=null!==e.selectedFormat&&("questions"===e.currentStep||"results"===e.currentStep||"coaching"===e.currentStep),r=t&&"extended"===s.phase,o=!t&&"core"===s.phase;return r||o}static getSessionSummary(){let e=this.getSessionData(),s=this.isSessionExpired(e);if(!e||s)return{isActive:!1,phase:null,timeRemaining:"0h 0m",expiresAt:null};let t=this.getTimeRemaining();return{isActive:!0,phase:e.phase,timeRemaining:"".concat(Math.floor(t/36e5),"h ").concat(Math.floor(t%36e5/6e4),"m"),expiresAt:new Date(e.expiresAt)}}}r.SESSION_KEY="mbti-session-data",r.extensionTimer=null},4553:function(e,s,t){t.d(s,{H:function(){return n}});class r{compressSAISResponses(e){let s=e.filter(e=>"distribution"===e.responseType&&void 0!==e.distributionA&&void 0!==e.distributionB),t={format:"sais",responses:s.map(e=>({q:parseInt(e.questionId),a:e.distributionA,b:e.distributionB,d:this.compressDimension(e.mbtiDimension),t:Math.floor(new Date(e.timestamp||Date.now()).getTime()/1e3)})),metadata:{totalQuestions:16,completed:s.length,lastModified:Date.now()}},r=JSON.stringify(s),o=JSON.stringify(t);return{compressed:o,originalSize:r.length,compressedSize:o.length,compressionRatio:(1-o.length/r.length)*100}}decompressSAISResponses(e){try{return JSON.parse(e).responses.map(e=>({questionId:e.q.toString(),responseId:"sais-".concat(e.q,"-").concat(Date.now()),sessionId:"",questionType:"extended",responseType:"distribution",distributionA:e.a,distributionB:e.b,mbtiDimension:this.decompressDimension(e.d),timestamp:new Date(1e3*e.t),score:0}))}catch(e){return console.error("Failed to decompress SAIS responses:",e),[]}}storeSAISAssessment(e,s){try{let{extendedResponses:t=[],...r}=s;if(!(t.length>0)||"sais"!==s.selectedFormat)return localStorage.setItem(e,JSON.stringify(s)),!0;{let s=this.compressSAISResponses(t),o="".concat(this.COMPRESSION_PREFIX).concat(e);localStorage.setItem(o,s.compressed);let a={...r,extendedResponsesCompressed:!0,compressionStats:{originalSize:s.originalSize,compressedSize:s.compressedSize,ratio:s.compressionRatio}};return localStorage.setItem(e,JSON.stringify(a)),s.compressionRatio>0&&console.log("SAIS compression saved ".concat(s.compressionRatio.toFixed(1),"% space")),!0}}catch(e){return console.error("Failed to store SAIS assessment:",e),!1}}retrieveSAISAssessment(e){try{let s=localStorage.getItem(e);if(!s)return null;let t=JSON.parse(s);if(t.extendedResponsesCompressed){let s="".concat(this.COMPRESSION_PREFIX).concat(e),r=localStorage.getItem(s);if(r){let s=this.decompressSAISResponses(r).map(s=>({...s,sessionId:e}));return{...t,extendedResponses:s,extendedResponsesCompressed:void 0,compressionStats:void 0}}}return t}catch(e){return console.error("Failed to retrieve SAIS assessment:",e),null}}batchUpdateSAIS(e,s){this.pendingUpdates.set(e,s),this.batchTimer&&clearTimeout(this.batchTimer),this.batchTimer=setTimeout(()=>{this.processBatchUpdates()},500)}processBatchUpdates(){this.pendingUpdates.forEach((e,s)=>{this.storeSAISAssessment(s,e)}),this.pendingUpdates.clear(),this.batchTimer=null}cleanupSAISData(e){try{let s="".concat(this.COMPRESSION_PREFIX).concat(e);localStorage.removeItem(s),localStorage.removeItem(e),this.pendingUpdates.delete(e)}catch(e){console.error("Failed to cleanup SAIS data:",e)}}checkSAISStorageHealth(){try{let e=0,s=0;for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);if(r){let t=localStorage.getItem(r);t&&(e+=r.length+t.length,r.startsWith(this.COMPRESSION_PREFIX)&&s++)}}let t=5242880-e;return{available:!0,usedSpace:e,estimatedCapacity:t,compressedSessions:s}}catch(e){return{available:!1,usedSpace:0,estimatedCapacity:0,compressedSessions:0}}}compressDimension(e){return e.charAt(0)}decompressDimension(e){return({E:"E/I",S:"S/N",T:"T/F",J:"J/P"})[e]||"E/I"}exportSAISData(e){let s=this.retrieveSAISAssessment(e);return s?JSON.stringify({version:"1.0",format:"sais-optimized",sessionId:e,timestamp:new Date().toISOString(),data:btoa(JSON.stringify(s))}):null}importSAISData(e){try{let s=JSON.parse(e);if("sais-optimized"!==s.format)return!1;let t=JSON.parse(atob(s.data));return this.storeSAISAssessment(s.sessionId,t)}catch(e){return console.error("Failed to import SAIS data:",e),!1}}constructor(){this.COMPRESSION_PREFIX="sais_compressed_",this.MAX_BATCH_SIZE=5,this.pendingUpdates=new Map,this.batchTimer=null}}let o=new r;class a{checkStorageHealth(){return{localStorage:this.isLocalStorageAvailable(),sessionStorage:this.isSessionStorageAvailable()}}getItem(e){if(this.mightBeSAISSession(e)){let s=o.retrieveSAISAssessment(e);if(s)return{success:!0,data:s,layer:"localStorage"}}let s=this.getFromLocalStorage(e);if(s.success)return{...s,layer:"localStorage"};let t=this.getFromSessionStorage(e);if(t.success)return{...t,layer:"sessionStorage"};let r=this.getFromMemory(e);return r.success?{...r,layer:"memory"}:{success:!1,error:"Item not found in any storage layer",layer:"memory"}}setItem(e,s){if(this.isSAISAssessmentData(e,s)&&o.storeSAISAssessment(e,s))return{success:!0,data:{savedTo:1,layers:"optimized",optimization:"sais-compressed"},layer:"localStorage"};let t=JSON.stringify(s),r=0,a=[],n=this.setToLocalStorage(e,t);n.success?r++:a.push("localStorage: ".concat(n.error));let i=this.setToSessionStorage(e,t);return i.success?r++:a.push("sessionStorage: ".concat(i.error)),this.memoryStorage.set(e,t),{success:++r>0,data:{savedTo:r,layers:3===r?"all":"partial",errors:a.length>0?a:void 0}}}removeItem(e){let s=0;if(this.mightBeSAISSession(e)&&o.cleanupSAISData(e),this.isLocalStorageAvailable())try{localStorage.removeItem(e),s++}catch(e){}if(this.isSessionStorageAvailable())try{sessionStorage.removeItem(e),s++}catch(e){}return this.memoryStorage.delete(e),{success:!0,data:{removedFrom:++s}}}clear(){let e=0;if(this.isLocalStorageAvailable())try{localStorage.clear(),e++}catch(e){}if(this.isSessionStorageAvailable())try{sessionStorage.clear(),e++}catch(e){}return this.memoryStorage.clear(),{success:!0,data:{clearedLayers:++e}}}isLocalStorageAvailable(){try{let e="__storage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return!1}}isSessionStorageAvailable(){try{let e="__storage_test__";return sessionStorage.setItem(e,"test"),sessionStorage.removeItem(e),!0}catch(e){return!1}}getFromLocalStorage(e){try{if(!this.isLocalStorageAvailable())return{success:!1,error:"localStorage not available"};let s=localStorage.getItem(e);if(null===s)return{success:!1,error:"Item not found"};return{success:!0,data:JSON.parse(s)}}catch(e){if(e instanceof Error&&"QuotaExceededError"===e.name)return{success:!1,error:"Storage quota exceeded"};return{success:!1,error:"localStorage read error"}}}getFromSessionStorage(e){try{if(!this.isSessionStorageAvailable())return{success:!1,error:"sessionStorage not available"};let s=sessionStorage.getItem(e);if(null===s)return{success:!1,error:"Item not found"};return{success:!0,data:JSON.parse(s)}}catch(e){return{success:!1,error:"sessionStorage read error"}}}getFromMemory(e){try{let s=this.memoryStorage.get(e);if(!s)return{success:!1,error:"Item not found in memory"};return{success:!0,data:JSON.parse(s)}}catch(e){return{success:!1,error:"Memory storage read error"}}}setToLocalStorage(e,s){try{if(!this.isLocalStorageAvailable())return{success:!1,error:"localStorage not available"};return localStorage.setItem(e,s),{success:!0}}catch(t){if(t instanceof Error&&"QuotaExceededError"===t.name){this.cleanupOldStorageItems("localStorage");try{return localStorage.setItem(e,s),{success:!0}}catch(e){return{success:!1,error:"Storage quota exceeded after cleanup"}}}return{success:!1,error:"localStorage write error"}}}setToSessionStorage(e,s){try{if(!this.isSessionStorageAvailable())return{success:!1,error:"sessionStorage not available"};return sessionStorage.setItem(e,s),{success:!0}}catch(e){if(e instanceof Error&&"QuotaExceededError"===e.name)return{success:!1,error:"Storage quota exceeded"};return{success:!1,error:"sessionStorage write error"}}}cleanupOldStorageItems(e){try{let s="localStorage"===e?localStorage:sessionStorage,t=Object.keys(s),r=Math.ceil(t.length/2);for(let e=0;e<r;e++)s.removeItem(t[e])}catch(e){}}isSAISAssessmentData(e,s){var t;return e.startsWith("session-")&&(null==s?void 0:s.selectedFormat)==="sais"&&(null==s?void 0:null===(t=s.extendedResponses)||void 0===t?void 0:t.length)>0}mightBeSAISSession(e){return e.startsWith("session-")}getExtendedHealth(){let e=this.checkStorageHealth(),s=o.checkSAISStorageHealth();return{...e,saisOptimization:s}}destroy(){this.memoryStorage.clear()}constructor(){this.memoryStorage=new Map}}let n=new a},9098:function(e,s,t){t.d(s,{u7:function(){return S}});var r=t(9625),o=t(6885),a=t(4553),n=t(5921);let i={scenarios:16,traits:20,sais:16},c={coreComplete:25,formatSelected:40},l={core:"core-foundation",scenarios:"life-scenarios",traits:"personality-traits",sais:"sais-methodology"},m={sessionId:"",currentStep:"welcome",language:"en",responses:[],coreResponses:[],extendedResponses:[],selectedFormat:null,progress:0,isComplete:!1},u={theme:"light",direction:"ltr",sidebarOpen:!1,currentPage:"home"},d=(0,r.Ue)()((0,o.mW)((e,s)=>({assessment:m,ui:u,setSessionId:s=>{n.m.initializeSession(s,"core"),e(e=>({assessment:{...e.assessment,sessionId:s}}))},setCurrentStep:s=>e(e=>({assessment:{...e.assessment,currentStep:s}})),setLanguage:s=>e(e=>({assessment:{...e.assessment,language:s},ui:{...e.ui,direction:"ar"===s?"rtl":"ltr"}})),addResponse:t=>e(e=>{let r;let o=e.assessment.responses.findIndex(e=>e.questionId===t.questionId);o>=0?(r=[...e.assessment.responses])[o]=t:r=[...e.assessment.responses,t];let a=[...e.assessment.coreResponses],n=[...e.assessment.extendedResponses];if("core"===t.questionType){let e=a.findIndex(e=>e.questionId===t.questionId);e>=0?a[e]=t:a.push(t)}else{let e=n.findIndex(e=>e.questionId===t.questionId);e>=0?n[e]=t:n.push(t)}let i={...e.assessment,responses:r,coreResponses:a,extendedResponses:n};return setTimeout(()=>{s().persistState()},0),{assessment:i}}),setResponses:s=>e(e=>{let t=s.filter(e=>"core"===e.questionType),r=s.filter(e=>"extended"===e.questionType);return{assessment:{...e.assessment,responses:s,coreResponses:t,extendedResponses:r}}}),setCoreResponses:s=>e(e=>({assessment:{...e.assessment,coreResponses:s}})),setExtendedResponses:s=>e(e=>({assessment:{...e.assessment,extendedResponses:s}})),setSelectedFormat:t=>{let r=s();r.assessment.sessionId&&n.m.transitionToExtendedPhase(r.assessment.sessionId);let o={totalQuestions:i[t],currentQuestionIndex:0,completedQuestions:4,questionPool:l[t]};e(e=>({assessment:{...e.assessment,selectedFormat:t,formatProgress:o,progress:c.formatSelected}}))},updateProgress:s=>e(e=>({assessment:{...e.assessment,progress:s}})),setProgress:s=>e(e=>({assessment:{...e.assessment,progress:s}})),calculateFormatSpecificProgress:()=>{let{selectedFormat:e,formatProgress:t,coreResponses:r,extendedResponses:o}=s().assessment;return e&&t?Math.min(100,Math.round((r.length+o.length)/t.totalQuestions*100)):r.length/4*c.coreComplete},updateFormatProgress:t=>{let{formatProgress:r}=s().assessment;if(!r)return;let o={...r,currentQuestionIndex:t,completedQuestions:4+t},a=s().calculateFormatSpecificProgress();e(e=>({assessment:{...e.assessment,formatProgress:o,progress:a}}))},completeAssessment:()=>e(e=>({assessment:{...e.assessment,isComplete:!0,currentStep:"results"}})),resetAssessment:()=>e(e=>({assessment:{...m,language:e.assessment.language}})),setInterimResults:s=>e(e=>({assessment:{...e.assessment,interimResults:s}})),setStartTime:s=>e(e=>({assessment:{...e.assessment,startTime:s}})),setCompletionTime:s=>e(e=>({assessment:{...e.assessment,completionTime:s}})),setCalculatedType:s=>e(e=>({assessment:{...e.assessment,calculatedType:s}})),setConfidence:s=>e(e=>({assessment:{...e.assessment,confidence:s}})),persistState:()=>{let e=s(),t={sessionId:e.assessment.sessionId,language:e.assessment.language,currentStep:e.assessment.currentStep,startTime:e.assessment.startTime||new Date,completionTime:e.assessment.completionTime,selectedFormat:e.assessment.selectedFormat,coreResponses:e.assessment.coreResponses,extendedResponses:e.assessment.extendedResponses,calculatedType:e.assessment.calculatedType,confidence:e.assessment.confidence,progress:e.assessment.progress,isComplete:e.assessment.isComplete,formatProgress:e.assessment.formatProgress};n.m.updateActivity(),a.H.setItem(e.assessment.sessionId,t)},restoreFromSession:s=>{try{let t=a.H.getItem(s);if(t.success&&t.data){let s=t.data;return e(e=>({assessment:{...e.assessment,sessionId:s.sessionId,language:s.language,currentStep:s.currentStep,startTime:s.startTime?new Date(s.startTime):void 0,completionTime:s.completionTime?new Date(s.completionTime):void 0,selectedFormat:s.selectedFormat,coreResponses:s.coreResponses||[],extendedResponses:s.extendedResponses||[],responses:[...s.coreResponses||[],...s.extendedResponses||[]],calculatedType:s.calculatedType,confidence:s.confidence,progress:s.progress,isComplete:s.isComplete,formatProgress:s.formatProgress},ui:{...e.ui,direction:"ar"===s.language?"rtl":"ltr"}})),!0}return!1}catch(e){return console.error("Failed to restore session:",e),!1}},setTheme:s=>e(e=>({ui:{...e.ui,theme:s}})),setDirection:s=>e(e=>({ui:{...e.ui,direction:s}})),toggleSidebar:()=>e(e=>({ui:{...e.ui,sidebarOpen:!e.ui.sidebarOpen}})),setCurrentPage:s=>e(e=>({ui:{...e.ui,currentPage:s}}))}),{name:"MBTI App Store"})),S=()=>d(e=>({sessionId:e.assessment.sessionId,currentStep:e.assessment.currentStep,language:e.assessment.language,responses:e.assessment.responses,coreResponses:e.assessment.coreResponses,extendedResponses:e.assessment.extendedResponses,selectedFormat:e.assessment.selectedFormat,progress:e.assessment.progress,isComplete:e.assessment.isComplete,startTime:e.assessment.startTime,completionTime:e.assessment.completionTime,calculatedType:e.assessment.calculatedType,confidence:e.assessment.confidence,interimResults:e.assessment.interimResults,formatProgress:e.assessment.formatProgress,setSessionId:e.setSessionId,setCurrentStep:e.setCurrentStep,setLanguage:e.setLanguage,addResponse:e.addResponse,setResponses:e.setResponses,setCoreResponses:e.setCoreResponses,setExtendedResponses:e.setExtendedResponses,setSelectedFormat:e.setSelectedFormat,updateProgress:e.updateProgress,setProgress:e.setProgress,calculateFormatSpecificProgress:e.calculateFormatSpecificProgress,updateFormatProgress:e.updateFormatProgress,completeAssessment:e.completeAssessment,resetAssessment:e.resetAssessment,setInterimResults:e.setInterimResults,setStartTime:e.setStartTime,setCompletionTime:e.setCompletionTime,setCalculatedType:e.setCalculatedType,setConfidence:e.setConfidence,persistState:e.persistState,restoreFromSession:e.restoreFromSession}))}}]);