"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[578],{5836:function(e,r,s){s.d(r,{j:function(){return c}});var t=s(7437),o=s(9376),n=s(9098);let a=e=>"ar"===e,i=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=a(e);return r?s?"flex-row-reverse":"flex-row":""};var l=s(2265);function c(){let e=(0,o.useRouter)(),r=(0,o.usePathname)(),{language:s,setLanguage:a}=(0,n.u7)(),[c,u]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=localStorage.getItem("preferredLanguage");e&&e!==s&&a(e)},[s,a]);let d=async()=>{let t="en"===s?"ar":"en";u(!0);try{a(t),localStorage.setItem("preferredLanguage",t);let s=r.split("/");s[1]=t,await e.push(s.join("/"))}catch(e){console.error("Language toggle error:",e)}finally{u(!1)}},f=i(s,!0);return(0,t.jsxs)("button",{onClick:d,disabled:c,className:"\n        ".concat(f,"\n        flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 \n        hover:border-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\n        ").concat("ar"===s?"font-arabic":"font-sans","\n      "),"aria-label":"en"===s?"Switch to Arabic":"Switch to English",children:[c?(0,t.jsx)("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-gray-300 border-t-gray-600"}):(0,t.jsx)("svg",{className:"w-4 h-4 ".concat("ar"===s?"rtl-flip":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"en"===s?"العربية":"English"})]})}},6164:function(e,r,s){s.d(r,{g:function(){return i}});var t=s(2265),o=s(9098),n=s(4553),a=s(5921);function i(){let e=(0,o.u7)(),r=(0,t.useRef)(null),s=(0,t.useRef)(!1),[i,c]=(0,t.useState)({isRestoring:!1,hasRestoredSession:!1,lastSaved:null,storageHealth:{localStorage:!1,sessionStorage:!1},errors:[]});(0,t.useEffect)(()=>{!function(){try{let e=n.H.checkStorageHealth();c(r=>({...r,storageHealth:e}))}catch(e){console.error("Storage health check failed:",e),c(e=>({...e,errors:[...e.errors,"Storage health check failed"]}))}}()},[]);let u=(0,t.useCallback)(()=>{if(!s.current&&e.sessionId)try{(()=>{var r;e.persistState();let s={lastModified:new Date().toISOString(),sessionPhase:a.m.getCurrentPhase(),currentQuestionIndex:(null===(r=e.formatProgress)||void 0===r?void 0:r.currentQuestionIndex)||0,totalQuestionsCompleted:e.coreResponses.length+e.extendedResponses.length};n.H.setItem("".concat(e.sessionId,"-metadata"),s)})(),r.current=new Date,c(e=>({...e,lastSaved:r.current,errors:e.errors.filter(e=>!e.includes("save"))}))}catch(e){console.error("Auto-persist failed:",e),c(e=>({...e,errors:[...e.errors,"Auto-save failed"]}))}},[e]);(0,t.useEffect)(()=>{if(s.current)return;let r=setTimeout(()=>{u()},"sais"===e.selectedFormat?500:1e3);return()=>clearTimeout(r)},[e.sessionId,e.currentStep,e.language,e.responses,e.selectedFormat,e.progress,e.isComplete,e.startTime,e.completionTime,e.calculatedType,e.confidence,u]);let d=(0,t.useCallback)(r=>{try{c(e=>({...e,isRestoring:!0})),s.current=!0;let o=r||l(),i=n.H.getItem(o);if(i.success&&i.data){let r=a.m.getSessionData();if(r&&a.m.isSessionExpired(r))return{success:!1,hasSession:!0,isExpired:!0};if(e.restoreFromSession(o)){var t;a.m.validateSessionState(e)||console.warn("Session state validation failed, but continuing with recovery");let r={step:e.currentStep,questionIndex:(null===(t=e.formatProgress)||void 0===t?void 0:t.currentQuestionIndex)||0,totalCompleted:e.coreResponses.length+e.extendedResponses.length};return c(e=>({...e,hasRestoredSession:!0,errors:e.errors.filter(e=>!e.includes("recovery"))})),{success:!0,hasSession:!0,isExpired:!1,exactPosition:r}}}return{success:!1,hasSession:!1,isExpired:!1}}catch(e){return console.error("Recovery attempt failed:",e),c(e=>({...e,errors:[...e.errors,"Recovery failed"]})),{success:!1,hasSession:!1,isExpired:!1,error:e instanceof Error?e.message:"Unknown error"}}finally{c(e=>({...e,isRestoring:!1})),s.current=!1}},[e]);(0,t.useEffect)(()=>{!function(){if(e.sessionId)return;let r=function(){try{let e=sessionStorage.getItem("mbti-assessment-session");if(e)return JSON.parse(e).sessionId||null;return Object.keys(localStorage).find(e=>e.startsWith("session-"))||null}catch(e){return console.error("Failed to get existing session ID:",e),null}}();if(r)d(r);else{let r=l();e.setSessionId(r),e.setStartTime(new Date)}}()},[]);let f=(0,t.useCallback)(e=>d(e),[d]),h=(0,t.useCallback)(r=>{let s=r||e.sessionId;if(s)try{n.H.removeItem(s),n.H.removeItem("".concat(s,"-metadata")),a.m.clearSessionData(),c(e=>({...e,hasRestoredSession:!1,lastSaved:null,errors:e.errors.filter(e=>!e.includes("clear"))}))}catch(e){console.error("Failed to clear session:",e),c(e=>({...e,errors:[...e.errors,"Failed to clear session"]}))}},[e.sessionId]),g=(0,t.useCallback)(()=>{u()},[u]);return{...e,persistence:{...i,recoverSession:f,clearSession:h,forceSave:g,checkStorageHealth:()=>{let e=n.H.checkStorageHealth();return c(r=>({...r,storageHealth:e})),e}}}}function l(){return"session-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))}}}]);